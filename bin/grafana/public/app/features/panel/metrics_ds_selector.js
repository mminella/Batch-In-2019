/*! grafana - v4.3.2 - 2017-05-31
 * Copyright (c) 2017 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["angular","lodash"],function(a,b){"use strict";var c,d,e,f,g;b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=c.default.module("grafana.directives"),f='\n<div class="gf-form-group">\n  <div class="gf-form-inline">\n    <div class="gf-form">\n      <label class="gf-form-label">\n        <i class="icon-gf icon-gf-datasources"></i>\n      </label>\n      <label class="gf-form-label">\n        Data Source\n      </label>\n\n      <metric-segment segment="ctrl.dsSegment"\n                      get-options="ctrl.getOptions(true)"\n                      on-change="ctrl.datasourceChanged()"></metric-segment>\n    </div>\n\n    <div class="gf-form gf-form--offset-1">\n      <button class="btn btn-secondary gf-form-btn" ng-click="ctrl.addDataQuery()" ng-hide="ctrl.current.meta.mixed">\n        <i class="fa fa-plus"></i>&nbsp;\n        Add query\n      </button>\n\n      <div class="dropdown" ng-if="ctrl.current.meta.mixed">\n        <metric-segment segment="ctrl.mixedDsSegment"\n                        get-options="ctrl.getOptions(false)"\n                        on-change="ctrl.mixedDatasourceChanged()"></metric-segment>\n      </div>\n    </div>\n  </div>\n</div>\n',g=function(){function a(a,b){this.uiSegmentSrv=a,this.datasources=b.getMetricSources();for(var c=this.panelCtrl.panel.datasource||null,d=0,e=this.datasources;d<e.length;d++){var f=e[d];f.value===c&&(this.current=f)}this.current||(this.current={name:c+" not found",value:null}),this.dsSegment=a.newSegment({value:this.current.name,selectMode:!0}),this.mixedDsSegment=a.newSegment({value:"Add query",selectMode:!0})}return a.$inject=["uiSegmentSrv","datasourceSrv"],a.prototype.getOptions=function(a){var b=this;return Promise.resolve(this.datasources.filter(function(b){return a||!b.meta.builtIn}).map(function(a){return b.uiSegmentSrv.newSegment(a.name)}))},a.prototype.datasourceChanged=function(){var a=d.default.find(this.datasources,{name:this.dsSegment.value});a&&(this.current=a,this.panelCtrl.setDatasource(a))},a.prototype.mixedDatasourceChanged=function(){var a={isNew:!0},b=d.default.find(this.datasources,{name:this.mixedDsSegment.value});b&&(a.datasource=b.name,this.panelCtrl.panel.targets.push(a),this.mixedDsSegment.value="")},a.prototype.addDataQuery=function(){var a={isNew:!0};this.panelCtrl.panel.targets.push(a)},a}(),a("MetricsDsSelectorCtrl",g),e.directive("metricsDsSelector",function(){return{restrict:"E",template:f,controller:g,bindToController:!0,controllerAs:"ctrl",transclude:!0,scope:{panelCtrl:"="}}})}}});